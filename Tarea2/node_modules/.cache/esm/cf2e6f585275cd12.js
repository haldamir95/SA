let Server,receptionRouter,fetchQuery,receptioncontroller,lineReader;_527‍.x([["receptionServer",()=>receptionServer]]);_527‍.w("../server",[["Server",["Server"],function(v){Server=v}]]);_527‍.w("../../routers/reception-router",[["routerV1",["receptionRouter"],function(v){receptionRouter=v}]]);_527‍.w("../../utilities/request-manager",[["fetchQuery",["fetchQuery"],function(v){fetchQuery=v}]]);_527‍.w("../../controllers/reception-controller",[["receptioncontroller",["receptioncontroller"],function(v){receptioncontroller=v}]]);_527‍.w("../../utilities/line-reader",[["lineReader",["lineReader"],function(v){lineReader=v}]]);


//import { configuration } from '../../config/config'



class ReceptionServer extends Server {
  constructor () {
    super(3001)
    super.routers(receptionRouter)
    this.menuMsn = '------ Ordenes sin procesar ------'
    this.consoleMsn = '------ Ingrese 0 para salir y 1 para mostrar menú ------\n'
  }

  async showOrders () {
    _527‍.g.console.log(this.menuMsn)
    const orders = receptioncontroller.orders.map((el, idx) => {
      if (el.status === 0) {
        console.log(`${idx + 1}.`, `C-${el.id.toString().padStart(6, '0')}`)
        return idx
      }
    })
    if (orders.length === 0) {
      console.log('------ No hay ordenes pendientes ------')
      return
    }
    let opt = -1
    while (!orders.includes(opt = await lineReader.askNumericQuestion('Elegir número de orden\n')));
    receptioncontroller.changeStatus(opt, 1)
    //this.placeOrder(opt)
  }

  placeOrder (index) {
    const { id, address } = receptioncontroller.orders[index]
    fetchQuery(configuration.DELIVERY_API_URL + '/accept', 'POST', { id, address }).then(res => {
      if (res.success) {
        console.log('Orden colocada')
      } else {
        console.log('No hay repartidores disponibles')
        receptioncontroller.changeStatus(index, 0)
      }
    })
  }

  async start () {
    const opt = -1
    while ((opt !== await lineReader.askQuestion(this.consoleMsn)) !== 0) {
      if (opt === 0) break
      this.showOrders()
    }
  }
}

       const receptionServer = new ReceptionServer()
